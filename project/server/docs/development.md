# CityInfo 后端开发文档

## 项目概述

CityInfo 是一个城市信息展示和搜索平台，提供城市、景点、餐厅、酒店等信息的浏览和搜索功能。本文档记录后端开发的主要内容和技术选型。

## 技术栈

- **运行时环境**：Node.js
- **开发语言**：TypeScript
- **Web框架**：Express.js
- **数据库**：PostgreSQL
- **ORM**：Prisma
- **认证**：JWT (JSON Web Token)
- **API文档**：Markdown
- **日志**：Winston
- **请求验证**：express-validator

## 项目结构

```
server/
├── docs/              # 文档目录
├── prisma/            # Prisma模型和迁移
├── src/
│   ├── controllers/   # 控制器
│   ├── middleware/    # 中间件
│   ├── routes/        # 路由
│   ├── utils/         # 工具函数
│   └── index.ts       # 应用入口
├── .env.example       # 环境变量示例
├── package.json       # 项目配置
└── tsconfig.json      # TypeScript配置
```

## 数据模型

### 用户模型 (User)
- 基本信息：ID、用户名、邮箱、密码
- 关联：收藏列表

### 城市模型 (City)
- 基本信息：ID、名称、英文名、描述、图片、位置
- 关联：景点、餐厅、酒店

### 景点模型 (Attraction)
- 基本信息：ID、名称、英文名、描述、图片、位置、价格、开放时间
- 关联：所属城市、评论

### 餐厅模型 (Restaurant)
- 基本信息：ID、名称、描述、图片、位置、菜系、价格区间
- 关联：所属城市、菜单、评论

### 酒店模型 (Hotel)
- 基本信息：ID、名称、描述、图片、位置、价格区间、评分
- 关联：所属城市、房间类型、评论

### 收藏模型 (Collection)
- 基本信息：ID、用户ID、收藏类型、收藏项目ID
- 关联：用户、收藏项目

## API 实现

### 认证模块
- 用户注册：密码加密、邮箱验证
- 用户登录：JWT令牌生成
- 身份验证：中间件实现

### 城市和景点模块
- 列表查询：分页、搜索、筛选
- 详情查询：关联数据加载
- 数据验证：请求参数校验

### 餐厅和酒店模块
- 列表查询：分页、搜索、筛选
- 详情查询：包含评论信息
- 价格区间筛选

### 收藏功能
- 添加收藏：支持多种类型
- 取消收藏：权限验证
- 收藏列表：分页查询

### 搜索功能
- 全局搜索：跨模块搜索
- 分类搜索：指定类型
- 结果聚合：统一返回格式

## 错误处理

### 统一错误处理中间件
- 自定义错误类
- HTTP状态码映射
- 错误响应格式化

### 日志记录
- 错误日志
- 访问日志
- 日志分级

## 安全措施

### 认证和授权
- JWT令牌验证
- 请求参数验证
- 权限检查

### 数据安全
- 密码加密
- 敏感信息过滤
- 输入验证

## 性能优化

### 数据库查询
- 关联查询优化
- 索引设计
- 分页处理

### 缓存策略
- 响应缓存
- 数据缓存
- 缓存更新

## 部署说明

### 环境要求
- Node.js >= 14
- PostgreSQL >= 12
- npm 或 yarn

### 配置说明
- 环境变量配置
- 数据库连接
- 服务器设置

### 部署步骤
1. 安装依赖
2. 配置环境变量
3. 数据库迁移
4. 启动服务

## 后续计划

### 功能增强
- 用户评论功能
- 图片上传功能
- 实时通知

### 性能优化
- 添加Redis缓存
- 优化搜索性能
- API限流

### 运维支持
- 监控系统
- 自动化部署
- 容器化部署